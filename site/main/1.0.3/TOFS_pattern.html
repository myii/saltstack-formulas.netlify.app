<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TOFS: A pattern for using SaltStack :: SaltStack Formulas</title>
    <link rel="canonical" href="https://saltstack-formulas.netlify.app/main/1.0.3/TOFS_pattern.html">
    <link rel="prev" href="CONTRIBUTING.html">
    <link rel="next" href="#accumulo-formula::README.adoc">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://saltstack-formulas.netlify.app">SaltStack Formulas</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="main" data-version="1.0.3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="README.html">SaltStack Formulas</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">General</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="README.html">README</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="CONTRIBUTING.html">How to contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="CONTRIBUTING.html#commit_message_formatting">Commit message formatting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="CONTRIBUTING.html#automatic_version_bump">Automatic version bump</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="CONTRIBUTING.html#commit_type_vs_version_bump">Commit type vs. version bump</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="CONTRIBUTING.html#documentation">Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="CONTRIBUTING.html#saltstack_formulas_rst_page_template">RST page template</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="TOFS_pattern.html">TOFS: A pattern for using SaltStack</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#before_tofs">Before TOFS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#template_override">Template Override</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#files_switch">Files Switch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#files_switch_macro">Files Switch macro</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#customise_source">Customise <code>source</code> further</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="https://github.com/saltstack-formulas" target="_blank" rel="noopener">GitHub organisation</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Formulas</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#accumulo-formula::README.adoc">accumulo-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ad-formula::README.adoc">ad-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#aegir-formula::README.adoc">aegir-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#alsa-formula::README.adoc">alsa-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#androidstudio-formula::README.adoc">androidstudio-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#apache-formula::README.adoc">apache-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#apt-cacher-formula::README.adoc">apt-cacher-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#apt-formula::README.adoc">apt-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#aptly-formula::README.adoc">aptly-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#aptmirror-formula::README.adoc">aptmirror-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#arvados-formula::README.adoc">arvados-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#asterisk-formula::README.adoc">asterisk-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#avahi-formula::README.adoc">avahi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#aws-formula::README.adoc">aws-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#backupninja-formula::README.adoc">backupninja-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#backuptocloud-formula::README.adoc">backuptocloud-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#bareos-formula::README.adoc">bareos-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#barman-formula::README.adoc">barman-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#beats-formula::README.adoc">beats-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#beaver-formula::README.adoc">beaver-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#bind-formula::README.adoc">bind-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#boundary-formula::README.adoc">boundary-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#bro-formula::README.adoc">bro-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-essential-formula::README.adoc">build-essential-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#canvas-formula::README.adoc">canvas-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cassandra-formula::README.adoc">cassandra-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ceph-formula::README.adoc">ceph-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cerebro-formula::README.adoc">cerebro-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cert-formula::README.adoc">cert-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#charles-formula::README.adoc">charles-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chartmuseum-formula::README.adoc">chartmuseum-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chef-formula::README.adoc">chef-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cherrypy-formula::README.adoc">cherrypy-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chrome-formula::README.adoc">chrome-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chromium-formula::README.adoc">chromium-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chrony-formula::README.adoc">chrony-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#circus-formula::README.adoc">circus-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#citrix-linuxvda-formula::README.adoc">citrix-linuxvda-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ckan-formula::README.adoc">ckan-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#clamav-formula::README.adoc">clamav-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cloudfoundry-formula::README.adoc">cloudfoundry-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cloudstack-formula::README.adoc">cloudstack-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cobbler-formula::README.adoc">cobbler-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cockroachdb-formula::README.adoc">cockroachdb-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#collectd-formula::README.adoc">collectd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#composer-formula::README.adoc">composer-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#consul-formula::README.adoc">consul-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#couchdb-formula::README.adoc">couchdb-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cron-formula::README.adoc">cron-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crontab-formula::README.adoc">crontab-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dansguardian-formula::README.adoc">dansguardian-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dbeaver-formula::README.adoc">dbeaver-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ddclient-formula::README.adoc">ddclient-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ddns-client-formula::README.adoc">ddns-client-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#debootstrap-formula::README.adoc">debootstrap-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deepsea-formula::README.adoc">deepsea-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dehydrated-formula::README.adoc">dehydrated-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#devstack-formula::README.adoc">devstack-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dhcpd-formula::README.adoc">dhcpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dirvish-formula::README.adoc">dirvish-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#django-formula::README.adoc">django-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#djbdns-formula::README.adoc">djbdns-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dnsmasq-formula::README.adoc">dnsmasq-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#docker-formula::README.adoc">docker-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dokuwiki-formula::README.adoc">dokuwiki-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#dovecot-formula::README.adoc">dovecot-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#drupal-formula::README.adoc">drupal-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#eclipse-formula::README.adoc">eclipse-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ejabberd-formula::README.adoc">ejabberd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#elasticsearch-formula::README.adoc">elasticsearch-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#elasticsearch-logstash-kibana-formula::README.adoc">elasticsearch-logstash-kibana-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#elrepo-formula::README.adoc">elrepo-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#emacs-formula::README.adoc">emacs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#emby-formula::README.adoc">emby-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#epazote-formula::README.adoc">epazote-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#epel-formula::README.adoc">epel-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#eramba-formula::README.adoc">eramba-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#erlang-formula::README.adoc">erlang-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#etcd-formula::README.adoc">etcd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#eucalyptus-formula::README.adoc">eucalyptus-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exim-formula::README.adoc">exim-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#fail2ban-formula::README.adoc">fail2ban-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#filebeat-formula::README.adoc">filebeat-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#firewalld-formula::README.adoc">firewalld-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#fluentbit-formula::README.adoc">fluentbit-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#flume-formula::README.adoc">flume-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#flussonic-formula::README.adoc">flussonic-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#frr-formula::README.adoc">frr-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gasmask-formula::README.adoc">gasmask-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gce-formula::README.adoc">gce-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gerrit-formula::README.adoc">gerrit-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#git-annex-formula::README.adoc">git-annex-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#git-formula::README.adoc">git-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gitlab-formula::README.adoc">gitlab-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gitolite-formula::README.adoc">gitolite-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#golang-formula::README.adoc">golang-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#grafana-formula::README.adoc">grafana-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#graphite-formula::README.adoc">graphite-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#graylog-formula::README.adoc">graylog-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#hadoop-formula::README.adoc">hadoop-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#halite-formula::README.adoc">halite-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#haproxy-formula::README.adoc">haproxy-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#haveged-formula::README.adoc">haveged-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#helm-formula::README.adoc">helm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#hostapd-formula::README.adoc">hostapd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#hosts-formula::README.adoc">hosts-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#hostsfile-formula::README.adoc">hostsfile-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#hugo-formula::README.adoc">hugo-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#icinga2-formula::README.adoc">icinga2-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#immortal-formula::README.adoc">immortal-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#influxdb-formula::README.adoc">influxdb-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#insomnia-formula::README.adoc">insomnia-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#iojs-formula::README.adoc">iojs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#iptables-formula::README.adoc">iptables-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#iscsi-formula::README.adoc">iscsi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ius-formula::README.adoc">ius-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#java-formula::README.adoc">java-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jdbc-formula::README.adoc">jdbc-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jenkins-formula::README.adoc">jenkins-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-appcode-formula::README.adoc">jetbrains-appcode-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-clion-formula::README.adoc">jetbrains-clion-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-datagrip-formula::README.adoc">jetbrains-datagrip-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-goland-formula::README.adoc">jetbrains-goland-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-intellij-formula::README.adoc">jetbrains-intellij-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-phpstorm-formula::README.adoc">jetbrains-phpstorm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-pycharm-formula::README.adoc">jetbrains-pycharm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-resharper-formula::README.adoc">jetbrains-resharper-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-rider-formula::README.adoc">jetbrains-rider-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-rubymine-formula::README.adoc">jetbrains-rubymine-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jetbrains-webstorm-formula::README.adoc">jetbrains-webstorm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#jmxtrans-formula::README.adoc">jmxtrans-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#joomla-formula::README.adoc">joomla-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#josm-formula::README.adoc">josm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kafka-formula::README.adoc">kafka-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#keepalived-formula::README.adoc">keepalived-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kerberos-formula::README.adoc">kerberos-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#keystone-formula::README.adoc">keystone-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kibana-formula::README.adoc">kibana-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kubernetes-formula::README.adoc">kubernetes-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#latex-formula::README.adoc">latex-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#letsencrypt-formula::README.adoc">letsencrypt-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#letsencrypt-sh-formula::README.adoc">letsencrypt-sh-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#librenms-formula::README.adoc">librenms-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#libvirt-formula::README.adoc">libvirt-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lighttpd-formula::README.adoc">lighttpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#linux-dev-formula::README.adoc">linux-dev-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lldpd-formula::README.adoc">lldpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#locale-formula::README.adoc">locale-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#logrotate-formula::README.adoc">logrotate-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#logstash-formula::README.adoc">logstash-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#logstash_forwarder-formula::README.adoc">logstash_forwarder-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lua-formula::README.adoc">lua-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lvm-formula::README.adoc">lvm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lxc-formula::README.adoc">lxc-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lxd-formula::README.adoc">lxd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#lynis-formula::README.adoc">lynis-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mailcatcher-formula::README.adoc">mailcatcher-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mailhog-formula::README.adoc">mailhog-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#maven-formula::README.adoc">maven-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mediawiki-formula::README.adoc">mediawiki-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#memcached-formula::README.adoc">memcached-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mercurial-formula::README.adoc">mercurial-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#metricbeat-formula::README.adoc">metricbeat-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#miniconda-formula::README.adoc">miniconda-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mirth-formula::README.adoc">mirth-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#molten-formula::README.adoc">molten-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mongodb-formula::README.adoc">mongodb-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#monit-formula::README.adoc">monit-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#moosefs-formula::README.adoc">moosefs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mopidy-formula::README.adoc">mopidy-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mounts-formula::README.adoc">mounts-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#msdtc-formula::README.adoc">msdtc-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mumble-server-formula::README.adoc">mumble-server-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#munin-formula::README.adoc">munin-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#mysql-formula::README.adoc">mysql-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nagios-formula::README.adoc">nagios-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nano-formula::README.adoc">nano-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-bgp-formula::README.adoc">napalm-bgp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-install-formula::README.adoc">napalm-install-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-interfaces-formula::README.adoc">napalm-interfaces-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-lldp-formula::README.adoc">napalm-lldp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-logging-formula::README.adoc">napalm-logging-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-ntp-formula::README.adoc">napalm-ntp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-snmp-formula::README.adoc">napalm-snmp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#napalm-users-formula::README.adoc">napalm-users-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#network-debian-formula::README.adoc">network-debian-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#newrelic-formula::README.adoc">newrelic-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nexus-formula::README.adoc">nexus-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nfs-formula::README.adoc">nfs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nginx-formula::README.adoc">nginx-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nifi-formula::README.adoc">nifi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#node-formula::README.adoc">node-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nomad-formula::README.adoc">nomad-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nscd-formula::README.adoc">nscd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ntp-formula::README.adoc">ntp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nut-formula::README.adoc">nut-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nvm-formula::README.adoc">nvm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#opencrowbar-formula::README.adoc">opencrowbar-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#opendkim-formula::README.adoc">opendkim-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openldap-formula::README.adoc">openldap-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openntpd-formula::README.adoc">openntpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#opensds-formula::README.adoc">opensds-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openssh-formula::README.adoc">openssh-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openstack-standalone-formula::README.adoc">openstack-standalone-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openvas-formula::README.adoc">openvas-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openvpn-client-formula::README.adoc">openvpn-client-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openvpn-formula::README.adoc">openvpn-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#openvswitch-formula::README.adoc">openvswitch-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#opsmatic-formula::README.adoc">opsmatic-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#os-hardening-formula::README.adoc">os-hardening-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#owncloud-formula::README.adoc">owncloud-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#oxidized-formula::README.adoc">oxidized-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pacemaker-corosync-formula::README.adoc">pacemaker-corosync-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#packages-formula::README.adoc">packages-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#packer-formula::README.adoc">packer-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pam-formula::README.adoc">pam-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pam-ldap-formula::README.adoc">pam-ldap-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pam_access-formula::README.adoc">pam_access-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pam_mount-formula::README.adoc">pam_mount-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#patchwork-formula::README.adoc">patchwork-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#perl-formula::README.adoc">perl-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pfring-formula::README.adoc">pfring-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#php-formula::README.adoc">php-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pimpmylog-formula::README.adoc">pimpmylog-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pip-formula::README.adoc">pip-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#piwik-formula::README.adoc">piwik-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#plex-formula::README.adoc">plex-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#plone-formula::README.adoc">plone-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#polycom-formula::README.adoc">polycom-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#postfix-formula::README.adoc">postfix-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#postgres-formula::README.adoc">postgres-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#postman-formula::README.adoc">postman-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#powerdns-formula::README.adoc">powerdns-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pppoe-formula::README.adoc">pppoe-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#proftpd-formula::README.adoc">proftpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#prometheus-formula::README.adoc">prometheus-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pulp-formula::README.adoc">pulp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#puppet-formula::README.adoc">puppet-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pureftpd-formula::README.adoc">pureftpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pydio-formula::README.adoc">pydio-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#python2-formula::README.adoc">python2-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#qpid-formula::README.adoc">qpid-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rabbitmq-formula::README.adoc">rabbitmq-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#raspberrypi-formula::README.adoc">raspberrypi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rdp-formula::README.adoc">rdp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rectangle-formula::README.adoc">rectangle-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#redis-formula::README.adoc">redis-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#redmine-formula::README.adoc">redmine-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#remi-formula::README.adoc">remi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#resolver-formula::README.adoc">resolver-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#reverse-grains-formula::README.adoc">reverse-grains-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#reverse-users-formula::README.adoc">reverse-users-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#riak-formula::README.adoc">riak-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rinetd-formula::README.adoc">rinetd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rkhunter-formula::README.adoc">rkhunter-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rlang-formula::README.adoc">rlang-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rng-tools-formula::README.adoc">rng-tools-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rspamd-formula::README.adoc">rspamd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rstudio-formula::README.adoc">rstudio-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rsyncd-formula::README.adoc">rsyncd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rsyslog-formula::README.adoc">rsyslog-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ruby-formula::README.adoc">ruby-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#rundeck-formula::README.adoc">rundeck-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#runit-formula::README.adoc">runit-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-api-reactor-formula::README.adoc">salt-api-reactor-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-docs-formula::README.adoc">salt-docs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-formula::README.adoc">salt-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-virt-formula::README.adoc">salt-virt-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#samba-formula::README.adoc">samba-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sbuild-formula::README.adoc">sbuild-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#schroot-formula::README.adoc">schroot-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#screen-formula::README.adoc">screen-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sensu-formula::README.adoc">sensu-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#shorewall-formula::README.adoc">shorewall-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#slurm-formula::README.adoc">slurm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#smokeping-formula::README.adoc">smokeping-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#snmp-formula::README.adoc">snmp-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#soda-delfin-formula::README.adoc">soda-delfin-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sogo-formula::README.adoc">sogo-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#solr-formula::README.adoc">solr-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#spark-formula::README.adoc">spark-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sphinx-doc-formula::README.adoc">sphinx-doc-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#splunkforwarder-formula::README.adoc">splunkforwarder-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sqldeveloper-formula::README.adoc">sqldeveloper-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sqlplus-formula::README.adoc">sqlplus-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#squid-formula::README.adoc">squid-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ssh-formula::README.adoc">ssh-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#strongswan-formula::README.adoc">strongswan-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#stunnel-formula::README.adoc">stunnel-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sudoers-formula::README.adoc">sudoers-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sugarcrm-formula::README.adoc">sugarcrm-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sumo-logic-formula::README.adoc">sumo-logic-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sun-java-formula::README.adoc">sun-java-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#supervisor-formula::README.adoc">supervisor-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#suricata-formula::README.adoc">suricata-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#svn-formula::README.adoc">svn-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#swapfile-formula::README.adoc">swapfile-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sysctl-formula::README.adoc">sysctl-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#syslog-ng-formula::README.adoc">syslog-ng-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#sysstat-formula::README.adoc">sysstat-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#systemd-formula::README.adoc">systemd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#telegraf-formula::README.adoc">telegraf-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../template-formula/1.3.10/README.html">template-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#thrift-formula::README.adoc">thrift-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#timezone-formula::README.adoc">timezone-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tinc-formula::README.adoc">tinc-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tinyproxy-formula::README.adoc">tinyproxy-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tmux-formula::README.adoc">tmux-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tomcat-formula::README.adoc">tomcat-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#twemproxy-formula::README.adoc">twemproxy-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ufw-formula::README.adoc">ufw-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ulog-formula::README.adoc">ulog-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#unitrends-agent-formula::README.adoc">unitrends-agent-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#uptime-formula::README.adoc">uptime-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#users-formula::README.adoc">users-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#uwsgi-formula::README.adoc">uwsgi-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vagrant-formula::README.adoc">vagrant-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#varnish-formula::README.adoc">varnish-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vault-formula::README.adoc">vault-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vim-formula::README.adoc">vim-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#virtualenv-formula::README.adoc">virtualenv-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vmbuilder-formula::README.adoc">vmbuilder-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vmware-tools-formula::README.adoc">vmware-tools-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vscode-formula::README.adoc">vscode-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vsftpd-formula::README.adoc">vsftpd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#wireguard-formula::README.adoc">wireguard-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#wordpress-formula::README.adoc">wordpress-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#wso2-formula::README.adoc">wso2-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#xinetd-formula::README.adoc">xinetd-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#yed-formula::README.adoc">yed-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#zabbix-formula::README.adoc">zabbix-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#zendserver-formula::README.adoc">zendserver-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#zfs-formula::README.adoc">zfs-formula</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#zookeeper-formula::README.adoc">zookeeper-formula</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other repos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#.github::README.adoc">.github</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ec2-autoscale-reactor::README.adoc">ec2-autoscale-reactor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ec2-conf::README.adoc">ec2-conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#gce-conf::README.adoc">gce-conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-cloud-reactor::README.adoc">salt-cloud-reactor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salter::README.adoc">salter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#saltify-conf::README.adoc">saltify-conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ssf-docker-images::README.adoc">ssf-docker-images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vagrant-dev-vm-reactor::README.adoc">vagrant-dev-vm-reactor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#vmware-conf::README.adoc">vmware-conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#workinggroup::README.adoc">workinggroup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="https://gitlab.com/saltstack-formulas" target="_blank" rel="noopener">GitLab organisation</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Build tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#salt-image-builder::README.adoc">salt-image-builder</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SaltStack Formulas</span>
    <span class="version">1.0.3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="README.html">SaltStack Formulas</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="README.html">1.0.3</a>
        </li>
        <li class="version">
          <a href="../1.0.2/README.html">1.0.2</a>
        </li>
        <li class="version">
          <a href="../1.0.1/README.html">1.0.1</a>
        </li>
        <li class="version">
          <a href="../1.0.0/README.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../template-formula/1.3.10/README.html">template-formula</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../template-formula/1.3.10/README.html">1.3.10</a>
        </li>
        <li class="version">
          <a href="../../template-formula/1.3.9/README.html">1.3.9</a>
        </li>
        <li class="version">
          <a href="../../template-formula/1.3.8/README.html">1.3.8</a>
        </li>
        <li class="version">
          <a href="../../template-formula/1.3.7/README.html">1.3.7</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="README.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="README.html">SaltStack Formulas</a></li>
    <li>General</li>
    <li><a href="TOFS_pattern.html">TOFS: A pattern for using SaltStack</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.0.3</button>
  <div class="version-menu">
    <a class="version is-current" href="TOFS_pattern.html">1.0.3</a>
    <a class="version" href="../1.0.2/TOFS_pattern.html">1.0.2</a>
    <a class="version" href="../1.0.1/TOFS_pattern.html">1.0.1</a>
    <a class="version" href="../1.0.0/TOFS_pattern.html">1.0.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/myii/saltstack-formulas.netlify.app/blob/v1.0.3/antora/modules/ROOT/pages/TOFS_pattern.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">TOFS: A pattern for using SaltStack</h1>
<div id="preamble">
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Authors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 25%;">
<col style="width: 35%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle"></th>
<th class="tableblock halign-left valign-middle">Person</th>
<th class="tableblock halign-left valign-middle">Contact</th>
<th class="tableblock halign-right valign-middle">Date</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Authored by</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roberto Moreda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:moreda@allenta.com">moreda@allenta.com</a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">29/12/2014</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Modified by</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Dehennin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:daniel.dehennin@baby-gnu.org">daniel.dehennin@baby-gnu.org</a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">07/02/2019</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Modified by</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imran Iqbal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/myii" class="bare">https://github.com/myii</a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">23/02/2019</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All that follows is a proposal based on my experience with
<a href="http://www.saltstack.com/">SaltStack</a>. The good thing of a piece of
software like this is that you can "bend it" to suit your needs in many
possible ways, and this is one of them. All the recommendations and
thoughts are given "as it is" with no warranty of any type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_of_values_in_pillar_vs_templates_in_file_roots"><a class="anchor" href="#_usage_of_values_in_pillar_vs_templates_in_file_roots"></a>1. Usage of values in pillar vs templates in <code>file_roots</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Among other functions, the <em>master</em> (or <em>salt-master</em>) serves files to
the <em>minions</em> (or <em>salt-minions</em>). The
<a href="http://docs.saltstack.com/en/latest/ref/file_server/file_roots.html">file_roots</a>
is the list of directories used in sequence to find a file when a minion
requires it: the first match is served to the minion. Those files could
be
<a href="http://docs.saltstack.com/en/latest/topics/tutorials/starting_states.html">state
files</a> or configuration templates, among others.</p>
</div>
<div class="paragraph">
<p>Using SaltStack is a simple and effective way to implement configuration
management, but even in a
<a href="http://en.wikipedia.org/wiki/Multitenancy">non-multitenant</a> scenario, it
is not a good idea to generally access some data (e.g. the database
password in our <a href="http://www.zabbix.com/">Zabbix</a> server configuration file
or the private key of our <a href="http://nginx.org/en/">Nginx</a> TLS certificate).</p>
</div>
<div class="paragraph">
<p>To avoid this situation we can use the
<a href="http://docs.saltstack.com/en/latest/topics/pillar/">pillar mechanism</a>,
which is designed to provide controlled access to data from the minions
based on some selection rules. As pillar data could be easily integrated
in the
<a href="http://docs.saltstack.com/en/latest/topics/tutorials/pillar.html">Jinja</a>
templates, it is a good mechanism to store values to be used in the
final rendering of state files and templates.</p>
</div>
<div class="paragraph">
<p>There are a variety of approaches on the usage of pillar and templates
as seen in the
<a href="https://github.com/saltstack-formulas">saltstack-formulas</a>' repositories.
<a href="https://github.com/saltstack-formulas/nginx-formula/pull/18">Some</a>
<a href="https://github.com/saltstack-formulas/php-formula/pull/14">developments</a>
stress the initial purpose of pillar data into a storage for most of the
possible variables for a determined system configuration. This, in my
opinion, is shifting too much load from the original template files
approach. Adding up some
<a href="https://github.com/spsoit/nginx-formula/blob/81de880fe0276dd9488ffa15bc78944c0fc2b919/nginx/ng/files/nginx.conf">non-trivial Jinja</a>
code as essential part of composing the state file definitely
makes SaltStack state files (hence formulas) more difficult to read. The
extreme of this approach is that we could end up with a new render
mechanism, implemented in Jinja, storing everything needed in pillar
data to compose configurations. Additionally, we are establishing a
strong dependency with the Jinja renderer.</p>
</div>
<div class="paragraph">
<p>In opposition to the <em>put the code in file_roots and the data in
pillars</em> approach, there is the <em>pillar as a store for a set of
key-values</em> approach. A full-blown configuration file abstracted in
pillar and jinja is complicated to develop, understand and maintain. I
think a better and simpler approach is to keep a configuration file
templated using just a basic (non-extensive but extensible) set of
pillar values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_the_reusability_of_saltstack_state_files"><a class="anchor" href="#_on_the_reusability_of_saltstack_state_files"></a>2. On the reusability of SaltStack state files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a brilliant initiative of the SaltStack community called
<a href="https://github.com/saltstack-formulas">salt-formulas</a>. Their goal is to
provide state files, pillar examples and configuration templates ready
to be used for provisioning. I am a contributor for two small ones:
<a href="https://github.com/saltstack-formulas/zabbix-formula">zabbix-formula</a> and
<a href="https://github.com/saltstack-formulas/varnish-formula">varnish-formula</a>.</p>
</div>
<div class="paragraph">
<p>The
<a href="http://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html">design
guidelines</a> for formulas are clear in many aspects and it is a
recommended reading for anyone willing to write state files, even
non-formulaic ones.</p>
</div>
<div class="paragraph">
<p>In the next section, I am going to describe my proposal to extend
further the reusability of formulas, suggesting some patterns of usage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_template_override_and_files_switch_tofs_pattern"><a class="anchor" href="#_the_template_override_and_files_switch_tofs_pattern"></a>3. The Template Override and Files Switch (TOFS) pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I understand a formula as a <strong>complete, independent set of SaltStack
state and configuration template files sufficient to configure a
system</strong>. A system could be something as simple as an NTP server or some
other much more complex service that requires many state and
configuration template files.</p>
</div>
<div class="paragraph">
<p>The customization of a formula should be done mainly by providing pillar
data used later to render either the state or the configuration template
files.</p>
</div>
<div class="sect2">
<h3 id="before_tofs"><a class="anchor" href="#before_tofs"></a>3.1. Example: NTP before applying TOFS</h3>
<div class="paragraph">
<p>Let&#8217;s work with the NTP example. A basic formula that follows the
<a href="http://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html">design
guidelines</a> has the following files and directories tree:</p>
</div>
<div class="listingblock">
<div class="title">Directory and file tree for NTP</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/srv/saltstack/salt-formulas/ntp-saltstack-formula/
  ntp/
    map.jinja
    init.sls
    conf.sls
    files/
      default/
        etc/
          ntp.conf.jinja</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use it, let&#8217;s assume a
<a href="http://docs.saltstack.com/en/latest/topics/tutorials/quickstart.html">masterless
configuration</a>:</p>
</div>
<div class="listingblock">
<div class="title"><code>/etc/salt/minion</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">pillar_roots:
  base:
    - /srv/saltstack/pillar
file_client: local
file_roots:
  base:
    - /srv/saltstack/salt
    - /srv/saltstack/salt-formulas/ntp-saltstack-formula</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/map.jinja</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-django hljs" data-lang="django">{%- set ntp = salt['grains.filter_by']({
  'default': {
    'pkg': 'ntp',
    'service': 'ntp',
    'config': '/etc/ntp.conf',
  },
}, merge=salt['pillar.get']('ntp:lookup')) %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>init.sls</code> we have the minimal states required to have NTP
configured. In many cases <code>init.sls</code> is almost equivalent to an
<code>apt-get install</code> or a <code>yum install</code> of the package.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/init.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">{%- from 'ntp/map.jinja' import ntp with context %}

Install NTP:
  pkg.installed:
    - name: {{ ntp.pkg }}

Enable and start NTP:
  service.running:
    - name: {{ ntp.service }}
    - enabled: True
    - require:
      - pkg: Install NTP package</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>conf.sls</code> we have the configuration states. In most cases, that is
just managing configuration file templates and making them to be watched
by the service.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/conf.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">include:
  - ntp

{%- from 'ntp/map.jinja' import ntp with context %}

Configure NTP:
  file.managed:
    - name: {{ ntp.config }}
    - template: jinja
    - source: salt://ntp/files/default/etc/ntp.conf.jinja
    - watch_in:
      - service: Enable and start NTP service
    - require:
      - pkg: Install NTP package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Under <code>files/default</code>, there is a structure that mimics the one in the
minion in order to avoid clashes and confusion on where to put the
needed templates. There you can find a mostly standard template for the
configuration file.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/files/default/etc/ntp.conf.jinja</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-django hljs" data-lang="django">{#- Managed by saltstack #}
{#- Edit pillars or override this template in saltstack if you need customization #}
{%- set settings = salt['pillar.get']('ntp', {}) %}
{%- set default_servers = ['0.ubuntu.pool.ntp.org',
                          '1.ubuntu.pool.ntp.org',
                          '2.ubuntu.pool.ntp.org',
                          '3.ubuntu.pool.ntp.org'] %}

driftfile /var/lib/ntp/ntp.drift
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

{%- for server in settings.get('servers', default_servers) %}
server {{ server }}
{%- endfor %}

restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery

restrict 127.0.0.1
restrict ::1</code></pre>
</div>
</div>
<div class="paragraph">
<p>With all this, it is easy to install and configure a simple NTP server
by just running <code>salt-call state.sls ntp.conf</code>: the package will be
installed, the service will be running and the configuration should be
correct for most of cases, even without pillar data.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can define a highstate in <code>top.sls</code>
and run <code>salt-call state.highstate</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt/top.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">base:
  '*':
    - ntp.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Customizing the formula just with pillar data</strong>, we have the option to
define the NTP servers.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/pillar/top.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">base:
  '*':
    - ntp</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/pillar/ntp.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ntp:
  servers:
    - 0.ch.pool.ntp.org
    - 1.ch.pool.ntp.org
    - 2.ch.pool.ntp.org
    - 3.ch.pool.ntp.org</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_override"><a class="anchor" href="#template_override"></a>3.2. Template Override</h3>
<div class="paragraph">
<p>If the customization based on pillar data is not enough, we can override
the template by creating a new one.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt/ntp/files/default/etc/ntp.conf.jinja</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-django hljs" data-lang="django">{#- Managed by saltstack #}
{#- Edit pillars or override this template in saltstack if you need customization #}

{#- Some bizarre configurations here #}
{#- ... #}

{%- for server in settings.get('servers', default_servers) %}
server {{ server }}
{%- endfor %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way we are locally <strong>overriding the template files</strong> offered by the
formula in order to make a more complex adaptation. Of course, this
could be applied as well to any of the files, including the state files.</p>
</div>
</div>
<div class="sect2">
<h3 id="files_switch"><a class="anchor" href="#files_switch"></a>3.3. Files Switch</h3>
<div class="paragraph">
<p>To bring some order into the set of template files included in a
formula, as we commented, we suggest having a similar structure to a
normal final file system under <code>files/default</code>.</p>
</div>
<div class="paragraph">
<p>We can make different templates coexist for different minions,
classified by any
<a href="http://docs.saltstack.com/en/latest/topics/targeting/grains.html">grain</a>
value, by simply creating new directories under <code>files</code>. This mechanism
is based on <strong>using values of some grains as a switch for the directories
under <code>files/</code></strong>.</p>
</div>
<div class="paragraph">
<p>If we decide that we want <code>os_family</code> as switch, then we could provide
the formula template variants for both the <code>RedHat</code> and <code>Debian</code>
families.</p>
</div>
<div class="listingblock">
<div class="title">Directory and file tree for the <code>files</code> sub-directory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/files/
  default/
    etc/
      ntp.conf.jinja
  RedHat/
    etc/
      ntp.conf.jinja
  Debian/
    etc/
      ntp.conf.jinja</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work we need a <code>conf.sls</code> state file that takes a list of
possible files as the configuration template.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/conf.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">include:
  - ntp

{%- from 'ntp/map.jinja' import ntp with context %}

Configure NTP:
  file.managed:
    - name: {{ ntp.config }}
    - template: jinja
    - source:
      - salt://ntp/files/{{ grains.get('os_family', 'default') }}/etc/ntp.conf.jinja
      - salt://ntp/files/default/etc/ntp.conf.jinja
    - watch_in:
      - service: Enable and start NTP service
    - require:
      - pkg: Install NTP package</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to cover the possibility of a special template for a minion
identified by <code>node01</code> then we could have a specific template.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt/ntp/files/node01/etc/ntp.conf.jinja</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-django hljs" data-lang="django">{#- Managed by saltstack #}
{#- Edit pillars or override this template in saltstack if you need customization #}

{#- Some crazy configurations here for node01 #}
{#- ... #}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work we could write a specially crafted <code>conf.sls</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/conf.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">include:
  - ntp

{%- from 'ntp/map.jinja' import ntp with context %}

Configure NTP:
  file.managed:
    - name: {{ ntp.config }}
    - template: jinja
    - source:
      - salt://ntp/files/{{ grains.get('id') }}/etc/ntp.conf.jinja
      - salt://ntp/files/{{ grains.get('os_family') }}/etc/ntp.conf.jinja
      - salt://ntp/files/default/etc/ntp.conf.jinja
    - watch_in:
      - service: Enable and start NTP service
    - require:
      - pkg: Install NTP package</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="files_switch_macro"><a class="anchor" href="#files_switch_macro"></a>3.4. Using the <code>files_switch</code> macro</h3>
<div class="paragraph">
<p>We can simplify the <code>conf.sls</code> with the new <code>files_switch</code> macro to use
in the <code>source</code> parameter for the <code>file.managed</code> state.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/conf.sls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">include:
  - ntp

{%- set tplroot = tpldir.split('/')[0] %}
{%- from 'ntp/map.jinja' import ntp with context %}
{%- from 'ntp/macros.jinja' import files_switch %}

Configure NTP:
  file.managed:
    - name: {{ ntp.config }}
    - template: jinja
    - source: {{ files_switch(
                  salt['config.get'](
                      tplroot ~ ':tofs:source_files:Configure NTP',
                      ['/etc/ntp.conf.jinja']
                  )
            ) }}
    - watch_in:
      - service: Enable and start NTP service
    - require:
      - pkg: Install NTP package</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This uses <code>config.get</code>, searching for <code>ntp:tofs:source_files:Configure NTP</code>
to determine the list of template files to use.</p>
</li>
<li>
<p>If this does not yield any results, the default of
<code>['/etc/ntp.conf.jinja']</code> will be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <code>macros.jinja</code>, we define this new macro <code>files_switch</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>/srv/saltstack/salt-formulas/ntp-saltstack-formula/ntp/macros.jinja</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-django hljs" data-lang="django">{%- macro files_switch(files,
                       default_files_switch=['id', 'os_family'],
                       indent_width=6) %}
  {#-
    Returns a valid value for the "source" parameter of a "file.managed"
    state function. This makes easier the usage of the Template Override and
    Files Switch (TOFS) pattern.

    Params:
      * files: ordered list of files to look for
      * default_files_switch: if there's no pillar
        '&lt;tplroot&gt;:tofs:files_switch' this is the ordered list of grains to
        use as selector switch of the directories under
        "&lt;path_prefix&gt;/files"
      * indent_witdh: indentation of the result value to conform to YAML

    Example (based on a `tplroot` of `xxx`):

    If we have a state:

      Deploy configuration:
        file.managed:
          - name: /etc/yyy/zzz.conf
          - source: {{ files_switch(
                          salt['config.get'](
                              tplroot ~ ':tofs:files:Deploy configuration',
                              ['/etc/yyy/zzz.conf', '/etc/yyy/zzz.conf.jinja']
                          )
                    ) }}
          - template: jinja

    In a minion with id=theminion and os_family=RedHat, it's going to be
    rendered as:

      Deploy configuration:
        file.managed:
          - name: /etc/yyy/zzz.conf
          - source:
            - salt://xxx/files/theminion/etc/yyy/zzz.conf
            - salt://xxx/files/theminion/etc/yyy/zzz.conf.jinja
            - salt://xxx/files/RedHat/etc/yyy/zzz.conf
            - salt://xxx/files/RedHat/etc/yyy/zzz.conf.jinja
            - salt://xxx/files/default/etc/yyy/zzz.conf
            - salt://xxx/files/default/etc/yyy/zzz.conf.jinja
          - template: jinja
  #}
  {#- Get the `tplroot` from `tpldir` #}
  {%- set tplroot = tpldir.split('/')[0] %}
  {%- set path_prefix = salt['config.get'](tplroot ~ ':tofs:path_prefix', tplroot) %}
  {%- set files_dir = salt['config.get'](tplroot ~ ':tofs:dirs:files', 'files') %}
  {%- set files_switch_list = salt['config.get'](
      tplroot ~ ':tofs:files_switch',
      default_files_switch
  ) %}
  {#- Only add to [''] when supporting older TOFS implementations #}
  {%- for path_prefix_ext in [''] %}
    {%- set path_prefix_inc_ext = path_prefix ~ path_prefix_ext %}
    {#- For older TOFS implementation, use `files_switch` from the pillar #}
    {#- Use the default, new method otherwise #}
    {%- set fsl = salt['pillar.get'](
        tplroot ~ path_prefix_ext|replace('/', ':') ~ ':files_switch',
        files_switch_list
    ) %}
    {#- Append an empty value to evaluate as `default` in the loop below #}
    {%- if '' not in fsl %}
      {%- do fsl.append('') %}
    {%- endif %}
    {%- for fs in fsl %}
      {%- for file in files %}
        {%- if fs %}
          {%- set fs_dir = salt['config.get'](fs, fs) %}
        {%- else %}
          {%- set fs_dir = salt['config.get'](tplroot ~ ':tofs:dirs:default', 'default') %}
        {%- endif %}
        {%- set url = '- salt://' ~ '/'.join([
            path_prefix_inc_ext,
            files_dir,
            fs_dir,
            file.lstrip('/')
        ]) %}
{{ url | indent(indent_width, true) }}
      {%- endfor %}
    {%- endfor %}
  {%- endfor %}
{%- endmacro %}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customise_source"><a class="anchor" href="#customise_source"></a>3.5. How to customise the <code>source</code> further</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Scenario for the examples below</div>
<div class="paragraph">
<p>The examples below are based on an <code>Ubuntu</code> minion called <code>theminion</code>
being configured via. pillar.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the default settings of the <code>files_switch</code> macro above, the
<code>source</code> will be:</p>
</div>
<div class="listingblock">
<div class="title"><code>source</code> (default)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - source:
      - salt://ntp/files/theminion/etc/ntp.conf.jinja
      - salt://ntp/files/Debian/etc/ntp.conf.jinja
      - salt://ntp/files/default/etc/ntp.conf.jinja</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_customise_files"><a class="anchor" href="#_customise_files"></a>3.5.1. Customise <code>files</code></h4>
<div class="paragraph">
<p>The <code>files</code> portion can be customised:</p>
</div>
<div class="listingblock">
<div class="title">Customise <code>files</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ntp:
  tofs:
    dirs:
      files: files_alt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="title"><code>source</code> with <code>files</code> customised</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - source:
      - salt://ntp/files_alt/theminion/etc/ntp.conf.jinja
      - salt://ntp/files_alt/Debian/etc/ntp.conf.jinja
      - salt://ntp/files_alt/default/etc/ntp.conf.jinja</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customise_the_use_of_grains"><a class="anchor" href="#_customise_the_use_of_grains"></a>3.5.2. Customise the use of grains</h4>
<div class="paragraph">
<p>Grains can be customised and even arbitrary paths can be supplied:</p>
</div>
<div class="listingblock">
<div class="title">Customise <code>grains</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ntp:
  tofs:
    files_switch:
      - any/path/can/be/used/here
      - id
      - os
      - os_family</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="title"><code>source</code> with <code>grains</code> customised</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - source:
      - salt://ntp/files/any/path/can/be/used/here/etc/ntp.conf.jinja
      - salt://ntp/files/theminion/etc/ntp.conf.jinja
      - salt://ntp/files/Ubuntu/etc/ntp.conf.jinja
      - salt://ntp/files/Debian/etc/ntp.conf.jinja
      - salt://ntp/files/default/etc/ntp.conf.jinja</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customise_the_default_path"><a class="anchor" href="#_customise_the_default_path"></a>3.5.3. Customise the <code>default</code> path</h4>
<div class="paragraph">
<p>The <code>default</code> portion of the path can be customised:</p>
</div>
<div class="listingblock">
<div class="title">Customise <code>default</code> directory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ntp:
  tofs:
    dirs:
      default: default_alt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="title"><code>source</code> with <code>default</code> directory customised</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - source:
      ...
      - salt://ntp/files/default_alt/etc/ntp.conf.jinja</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customise_the_list_of_source_files"><a class="anchor" href="#_customise_the_list_of_source_files"></a>3.5.4. Customise the list of <code>source_files</code></h4>
<div class="paragraph">
<p>The list of <code>source_files</code> can be given:</p>
</div>
<div class="listingblock">
<div class="title">Customise <code>source_files</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ntp:
  tofs:
    source_files:
      Configure NTP:
        - '/etc/ntp.conf.jinja'
        - '/etc/ntp.conf_alt.jinja'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="title"><code>source</code> with <code>source_files</code> customised</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - source:
      - salt://ntp/files/theminion/etc/ntp.conf.jinja
      - salt://ntp/files/theminion/etc/ntp.conf_alt.jinja
      - salt://ntp/files/Debian/etc/ntp.conf.jinja
      - salt://ntp/files/Debian/etc/ntp.conf_alt.jinja
      - salt://ntp/files/default/etc/ntp.conf.jinja
      - salt://ntp/files/default/etc/ntp.conf_alt.jinja</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="CONTRIBUTING.html">How to contribute</a></span>
  <span class="next"><a href="#accumulo-formula::README.adoc">accumulo-formula</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
